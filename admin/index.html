<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Comprei Barato</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        .loading {
            font-size: 1.2rem;
            font-weight: 500;
        }
        .error {
            color: #ff6b6b;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="loading">
        Verificando autenticação...
    </div>
    <div id="error" class="error" style="display: none;"></div>
    
    <script src="../database_simple.js"></script>
    <script>
        // Verificar se está logado
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('admin_logged_in') === 'true';
            const sessionToken = sessionStorage.getItem('admin_session_token');
            
            if (!isLoggedIn || !sessionToken) {
                // Não está logado, redirecionar para login
                window.location.href = 'login.html';
                return;
            }
            
            // Verificar se a sessão ainda é válida
            try {
                const sessionData = JSON.parse(sessionToken);
                const now = new Date();
                const sessionTime = new Date(sessionData.created_at);
                const diffInSeconds = (now - sessionTime) / 1000;
                
                // Sessão expira em 1 hora (3600 segundos)
                if (diffInSeconds > 3600) {
                    // Sessão expirada
                    sessionStorage.removeItem('admin_logged_in');
                    sessionStorage.removeItem('admin_session_token');
                    sessionStorage.removeItem('admin_username');
                    window.location.href = 'login.html';
                    return;
                }
                
                // Sessão válida, redirecionar para o painel admin
                                       window.location.href = 'admin.html';
                
            } catch (error) {
                console.error('Erro ao verificar sessão:', error);
                // Limpar dados corrompidos
                sessionStorage.removeItem('admin_logged_in');
                sessionStorage.removeItem('admin_session_token');
                sessionStorage.removeItem('admin_username');
                window.location.href = 'login.html';
            }
        }
        
        // Executar verificação após um pequeno delay para garantir que o dbManager foi carregado
        setTimeout(checkAuth, 100);
    </script>
</body>
</html>
